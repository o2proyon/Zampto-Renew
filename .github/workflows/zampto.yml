name: Zampto Renew

on:
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨ç‚¹æŒ‰é’®è¿è¡Œ
  schedule:
    - cron: '0 1 */2 * *'

jobs:
  run_zampto_job:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ä¸‹è½½ä»£ç 
      uses: actions/checkout@v4

    - name: ğŸ è®¾ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # === æ ¸å¿ƒï¼šå¯åŠ¨ Gost ä»£ç†è½¬å‘ ===
    - name: ğŸ›¡ï¸ å¯åŠ¨ Gost ä»£ç†è½¬å‘
      run: |
        wget https://github.com/ginuerzh/gost/releases/download/v2.11.5/gost-linux-amd64-2.11.5.gz
        gunzip gost-linux-amd64-2.11.5.gz
        chmod +x gost-linux-amd64-2.11.5
        mv gost-linux-amd64-2.11.5 gost
        # å¯åŠ¨è½¬å‘ï¼šæœ¬åœ° 8080 -> ä½ çš„ SOCKS5
        nohup ./gost -L http://:8080 -F socks5://x:x@123.456.789.123:1234 > gost.log 2>&1 &
        sleep 3
        echo "æµ‹è¯•æœ¬åœ°ä»£ç†..."
        curl -x http://127.0.0.1:8080 https://api.ipify.org -v

    - name: ğŸ› ï¸ å®‰è£…ç¯å¢ƒ
      run: |
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable xvfb
        pip install seleniumbase
        seleniumbase install chromedriver

    - name: ğŸš€ è¿è¡Œ Zampto è„šæœ¬
      run: |
        xvfb-run -a python renew_zampto.py

    - name: ğŸ“¸ ä¸Šä¼ æˆªå›¾
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: zampto-screenshots
        path: "*.png"
